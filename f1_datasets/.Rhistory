add_overall()
library(labelled)
leclerc_results$fastestLapSpeed <- as.numeric(leclerc_results$fastestLapSpeed)
leclerc_results$results_position <- as.numeric(leclerc_results$results_position)
leclerc_table1 <- leclerc_results %>%
mutate(
performance_category = case_when(
results_position %in% 1:3 ~ "Podium (P1–P3)",
results_position %in% 4:10 ~ "Points Zone (P4–P10)",
results_position %in% 11:20 | is.na(results_position) ~ "Non-Scoring (P11–P20/DNF)"
)
)
leclerc_table1 <- leclerc_table1 %>%
mutate(
performance_category = factor(
performance_category,
levels = c("Podium (P1–P3)", "Points Zone (P4–P10)", "Non-Scoring (P11–P20/DNF)")
)
)
var_label(leclerc_table1) <- list(
qualifying_position = "Qualifying Position",
grid = "Starting Grid",
results_position = "Race Finish Position",
points = "Points Scored",
fastestLapSpeed = "Fastest Lap Speed (km/h)"
)
table1_vars <- leclerc_table1 %>%
select(performance_category,
grid, qualifying_position, results_position,
points, laps, fastestLapTime, fastestLapSpeed)
table1 <- table1_vars %>%
tbl_summary(
by = performance_category,  # stratify by outcome group
type = list(
qualifying_position ~ "continuous",
grid ~ "continuous",
results_position ~ "continuous",
points ~ "continuous",
fastestLapSpeed ~ "continuous"
),
statistic = list(
all_continuous() ~ "{mean} ± {sd}",
all_categorical() ~ "{n} ({p}%)"
),
missing = "no"
) %>%
modify_spanning_header(all_stat_cols() ~ "**By Race Outcome**") %>%
bold_labels() %>%
add_p %>%
add_overall()
leclerc_results$fastestLapSpeed <- as.numeric(leclerc_results$fastestLapSpeed)
leclerc_results$results_position <- as.numeric(leclerc_results$results_position)
leclerc_table1 <- leclerc_results %>%
mutate(
performance_category = case_when(
results_position %in% 1:3 ~ "Podium (P1–P3)",
results_position %in% 4:10 ~ "Points Zone (P4–P10)",
results_position %in% 11:20 | is.na(results_position) ~ "Non-Scoring (P11–P20/DNF)"
)
)
leclerc_table1 <- leclerc_table1 %>%
mutate(
performance_category = factor(
performance_category,
levels = c("Podium (P1–P3)", "Points Zone (P4–P10)", "Non-Scoring (P11–P20/DNF)")
)
)
var_label(leclerc_table1) <- list(
qualifying_position = "Qualifying Position",
grid = "Starting Grid",
results_position = "Race Finish Position",
points = "Points Scored",
fastestLapSpeed = "Fastest Lap Speed (km/h)"
)
table1_vars <- leclerc_table1 %>%
select(performance_category,
qualifying_position, grid, results_position,
points, fastestLapSpeed)
table1 <- table1_vars %>%
tbl_summary(
by = performance_category,  # stratify by outcome group
type = list(
qualifying_position ~ "continuous",
grid ~ "continuous",
results_position ~ "continuous",
points ~ "continuous",
fastestLapSpeed ~ "continuous"
),
statistic = list(
all_continuous() ~ "{mean} ± {sd}",
all_categorical() ~ "{n} ({p}%)"
),
missing = "no"
) %>%
modify_spanning_header(all_stat_cols() ~ "**By Race Outcome**") %>%
bold_labels() %>%
add_p %>%
add_overall()
table1
install.packages("moments")
library(moments)
skewness(leclerc_ferrari_results$qualifying_position, na.rm = TRUE)
skewness(leclerc_results$qualifying_position, na.rm = TRUE)
skewness(leclerc_results$fastestLapSpeed, na.rm = TRUE)
leclerc_results$fastestLapSpeed <- as.numeric(leclerc_results$fastestLapSpeed)
leclerc_results$results_position <- as.numeric(leclerc_results$results_position)
leclerc_table1 <- leclerc_results %>%
mutate(
performance_category = case_when(
results_position %in% 1:3 ~ "Podium (P1–P3)",
results_position %in% 4:10 ~ "Points Zone (P4–P10)",
results_position %in% 11:20 | is.na(results_position) ~ "Non-Scoring (P11–P20/DNF)"
)
)
leclerc_table1 <- leclerc_table1 %>%
mutate(
performance_category = factor(
performance_category,
levels = c("Podium (P1–P3)", "Points Zone (P4–P10)", "Non-Scoring (P11–P20/DNF)")
)
)
var_label(leclerc_table1) <- list(
qualifying_position = "Qualifying Position",
grid = "Starting Grid",
results_position = "Race Finish Position",
points = "Points Scored",
fastestLapSpeed = "Fastest Lap Speed (km/h)"
)
table1_vars <- leclerc_table1 %>%
select(performance_category,
qualifying_position, grid, results_position,
points, fastestLapSpeed)
table1 <- table1_vars %>%
tbl_summary(
by = performance_category,  # stratify by outcome group
statistic = list(
qualifying_position ~ "{median} ({p25}, {p75})",
grid ~ "{median} ({p25}, {p75})",
results_position ~ "{median} ({p25}, {p75})",
points ~ "{median} ({p25}, {p75})",
fastestLapSpeed ~ "continuous"
),
missing = "no"
) %>%
modify_spanning_header(all_stat_cols() ~ "**By Race Outcome**") %>%
bold_labels() %>%
add_p %>%
add_overall()
table1
table1
leclerc_results$fastestLapSpeed <- as.numeric(leclerc_results$fastestLapSpeed)
leclerc_results$results_position <- as.numeric(leclerc_results$results_position)
leclerc_table1 <- leclerc_results %>%
mutate(
performance_category = case_when(
results_position %in% 1:3 ~ "Podium (P1–P3)",
results_position %in% 4:10 ~ "Points Zone (P4–P10)",
results_position %in% 11:20 | is.na(results_position) ~ "Non-Scoring (P11–P20/DNF)"
)
)
leclerc_table1 <- leclerc_table1 %>%
mutate(
performance_category = factor(
performance_category,
levels = c("Podium (P1–P3)", "Points Zone (P4–P10)", "Non-Scoring (P11–P20/DNF)")
)
)
var_label(leclerc_table1) <- list(
qualifying_position = "Qualifying Position",
grid = "Starting Grid",
results_position = "Race Finish Position",
points = "Points Scored",
fastestLapSpeed = "Fastest Lap Speed (km/h)"
)
table1_vars <- leclerc_table1 %>%
select(performance_category,
qualifying_position, grid, results_position,
points, fastestLapSpeed)
table1 <- table1_vars %>%
tbl_summary(
by = performance_category,  # stratify by outcome group
statistic = list(
qualifying_position ~ "{median} ({p25}, {p75})",
grid ~ "{median} ({p25}, {p75})",
results_position ~ "{median} ({p25}, {p75})",
points ~ "{median} ({p25}, {p75})",
fastestLapSpeed ~ "{mean} ± {sd}"
),
missing = "no"
) %>%
modify_spanning_header(all_stat_cols() ~ "**By Race Outcome**") %>%
bold_labels() %>%
add_p %>%
add_overall()
table1
table1
path <- here::here("f1_datasets")
path <- here::here("f1_datasets")
files <- list.files(path, pattern = "*.csv", full.names = TRUE)
tables <- lapply(files, read_csv)
names(tables) <- gsub(".csv", "", basename(files))
data <- tables$results %>%
left_join(tables$races, by = "raceId") %>%
left_join(tables$drivers, by = "driverId") %>%
left_join(tables$qualifying, by = c("raceId", "driverId")) %>%
filter(driverRef == "leclerc", constructorId.x == "6")  %>%
select(
raceId, year, round, circuitId,
constructorId = constructorId.x, driverId, driverRef, surname, forename,
grid,
results_position = position.x,
qualifying_position = position.y,
positionOrder, points, laps,
time = time.x,  # race time
fastestLap, fastestLapTime, fastestLapSpeed,
q1, q2, q3
)
path <- here::here("/DATA550/finalproject/f1_datasets")
files <- list.files(path, pattern = "*.csv", full.names = TRUE)
tables <- lapply(files, read_csv)
names(tables) <- gsub(".csv", "", basename(files))
data <- tables$results %>%
left_join(tables$races, by = "raceId") %>%
left_join(tables$drivers, by = "driverId") %>%
left_join(tables$qualifying, by = c("raceId", "driverId")) %>%
filter(driverRef == "leclerc", constructorId.x == "6")  %>%
select(
raceId, year, round, circuitId,
constructorId = constructorId.x, driverId, driverRef, surname, forename,
grid,
results_position = position.x,
qualifying_position = position.y,
positionOrder, points, laps,
time = time.x,  # race time
fastestLap, fastestLapTime, fastestLapSpeed,
q1, q2, q3
)
path <- here::here("/DATA550/finalproject/f1_datasets")
path <- here::here("/DATA550/finalproject/f1_datasets")
getwd()
here::i_am("/finalproject")
here::i_am("finalproject")
setwd("/Users/nazizanaeer/Documents/R/DATA550/finalproject")
path <- here::here("f1_datasets")
files <- list.files(path, pattern = "*.csv", full.names = TRUE)
tables <- lapply(files, read_csv)
names(tables) <- gsub(".csv", "", basename(files))
setwd("/Users/nazizanaeer/Documents/R/DATA550/finalproject/f1_datasets")
path <- here::here("f1_datasets")
files <- list.files(path, pattern = "*.csv", full.names = TRUE)
tables <- lapply(files, read_csv)
names(tables) <- gsub(".csv", "", basename(files))
results <- read.csv("f1_datasets/results.csv")
races <- read.csv("f1_datasets/races.csv")
drivers <- read.csv("f1_datasets/drivers.csv")
qualifying <- read.csv("f1_datasets/qualifying.csv")
circuits <- read.csv("f1_datasets/circuits.csv")
results <- read.csv(here("f1_datasets/results.csv"))
results <- read.csv(here::here("f1_datasets/results.csv"))
results <- read.csv(here::here("results.csv"))
here::here
here::here()
results <- read.csv(here::here("f1_datasets", "results.csv"))
results <- read.csv(here::here("results.csv"))
results <- read_csv(here("results.csv"))
library(here)
library(readr)
results <- read_csv(here("results.csv"))
library(here)
library(readr)
results <- read_csv(here("f1_datasets","results.csv"))
results <- read_csv(here("DATA550/f1_datasets","results.csv"))
results <- read_csv(here("DATA550/finalproject/f1_datasets","results.csv"))
here::here()
results <- read.csv("f1_datasets/results.csv")
races <- read.csv("f1_datasets/races.csv")
drivers <- read.csv("f1_datasets/drivers.csv")
qualifying <- read.csv("f1_datasets/qualifying.csv")
circuits <- read.csv("f1_datasets/circuits.csv")
data <- tables$results %>%
left_join(tables$races, by = "raceId") %>%
left_join(tables$drivers, by = "driverId") %>%
left_join(tables$qualifying, by = c("raceId", "driverId")) %>%
filter(driverRef == "leclerc", constructorId.x == "6")  %>%
select(
raceId, year, round, circuitId,
constructorId = constructorId.x, driverId, driverRef, surname, forename,
grid,
results_position = position.x,
qualifying_position = position.y,
positionOrder, points, laps,
time = time.x,  # race time
fastestLap, fastestLapTime, fastestLapSpeed,
q1, q2, q3
)
data <- results %>%
left_join(races, by = "raceId") %>%
left_join(drivers, by = "driverId") %>%
left_join(qualifying, by = c("raceId", "driverId")) %>%
filter(driverRef == "leclerc", constructorId.x == "6")  %>%
select(
raceId, year, round, circuitId,
constructorId = constructorId.x, driverId, driverRef, surname, forename,
grid,
results_position = position.x,
qualifying_position = position.y,
positionOrder, points, laps,
time = time.x,  # race time
fastestLap, fastestLapTime, fastestLapSpeed,
q1, q2, q3
)
ggplot(data1, aes(x = qualifying_position, y = results_position, color = performance_category)) +
geom_point(size = 3, alpha = 0.7) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +  # y = x line
scale_y_reverse() +  # optional: lower finish positions are better
scale_x_reverse() +  # optional: lower qualifying is better
labs(
title = "Qualifying Position vs Race Finish (Leclerc Ferrari 2019-2024)",
x = "Qualifying Position",
y = "Race Finish Position",
color = "Performance Category"
) +
theme_minimal()
data$fastestLapSpeed <- as.numeric(data$fastestLapSpeed)
data$results_position <- as.numeric(data$results_position)
data1 <- data %>%
mutate(
performance_category = case_when(
results_position %in% 1:3 ~ "Podium (P1–P3)",
results_position %in% 4:10 ~ "Points Zone (P4–P10)",
results_position %in% 11:20 | is.na(results_position) ~ "Non-Scoring (P11–P20/DNF)"
)
)
data1 <- data1 %>%
mutate(
performance_category = factor(
performance_category,
levels = c("Podium (P1–P3)", "Points Zone (P4–P10)", "Non-Scoring (P11–P20/DNF)")
)
)
var_label(data1) <- list(
qualifying_position = "Qualifying Position",
grid = "Starting Grid",
results_position = "Race Finish Position",
points = "Points Scored",
fastestLapSpeed = "Fastest Lap Speed (km/h)"
)
table1_vars <- data1 %>%
select(performance_category,
qualifying_position, grid, results_position,
points, fastestLapSpeed)
table1 <- table1_vars %>%
tbl_summary(
by = performance_category,  # stratify by outcome group
statistic = list(
qualifying_position ~ "{median} ({p25}, {p75})",
grid ~ "{median} ({p25}, {p75})",
results_position ~ "{median} ({p25}, {p75})",
points ~ "{median} ({p25}, {p75})",
fastestLapSpeed ~ "{mean} ± {sd}"
),
missing = "no"
) %>%
modify_spanning_header(all_stat_cols() ~ "**By Race Outcome**") %>%
bold_labels() %>%
add_p %>%
add_overall()
table1
ggplot(data1, aes(x = qualifying_position, y = results_position, color = performance_category)) +
geom_point(size = 3, alpha = 0.7) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +  # y = x line
scale_y_reverse() +  # optional: lower finish positions are better
scale_x_reverse() +  # optional: lower qualifying is better
labs(
title = "Qualifying Position vs Race Finish (Leclerc Ferrari 2019-2024)",
x = "Qualifying Position",
y = "Race Finish Position",
color = "Performance Category"
) +
theme_minimal()
ggplot(data1, aes(x = qualifying_position, y = results_position, color = performance_category)) +
geom_point(size = 3, alpha = 0.7) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +
scale_color_manual(values = c("Podium" = "#DC0000",   # Ferrari red
"Points Zone" = "#FFF500",
"Non-Scoring" = "gray")) +
scale_y_reverse() +
scale_x_reverse() +
labs(
title = "Qualifying Position vs Race Finish (Leclerc Ferrari 2019-2024)",
x = "Qualifying Position",
y = "Race Finish Position",
color = "Performance Category"
) +
theme_minimal()
ggplot(data1, aes(x = qualifying_position, y = results_position, color = performance_category)) +
geom_point(size = 3, alpha = 0.7) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +
scale_color_manual(values = c(
"Podium (P1–P3)" = "#DC0000",       # Ferrari red
"Points Zone (P4–P10)" = "#FFF500",
"Non-Scoring (P11–P20/DNF)" = "gray"
)) +
scale_y_reverse() +
scale_x_reverse() +
labs(
title = "Qualifying Position vs Race Finish (Leclerc Ferrari 2019-2024)",
x = "Qualifying Position",
y = "Race Finish Position",
color = "Performance Category"
) +
theme_minimal()
# logistic regression: probability of win from pole
glm(win ~ pole, data = data, family = "binomial") %>% summary()
# 2. Pole effect
data <- data %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
# logistic regression: probability of win from pole
glm(win ~ pole, data = data, family = "binomial") %>% summary()
# chi-square: pole vs podium
table(data$pole, data$podium) %>% chisq.test()
ggplot(data1, aes(x = qualifying_position, y = results_position, color = performance_category)) +
geom_point(size = 3, alpha = 0.7) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +
scale_color_manual(values = c(
"Podium (P1–P3)" = "#DC0000",       # Ferrari red
"Points Zone (P4–P10)" = "#FFF500",
"Non-Scoring (P11–P20/DNF)" = "gray"
)) +
scale_y_reverse() +
scale_x_reverse() +
labs(
title = "Qualifying Position vs Race Finish (Leclerc Ferrari 2019-2024)",
x = "Qualifying Position",
y = "Race Finish Position",
color = "Performance Category"
) +
theme_minimal()
# Pole effect
data <- data %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
# logistic regression: probability of win from pole
glm(win ~ pole, data = data, family = "binomial") %>% summary()
# chi-square: pole vs podium
table(data$pole, data$podium) %>% chisq.test()
# Pole effect
data <- data %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
glm(win ~ pole, data = data, family = "binomial") %>% summary()
# Pole effect
data <- data %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
logit <- glm(win ~ pole, data = data, family = "binomial") %>% summary()
tbl_logit <- tbl_regression(
logit_model,
exponentiate = TRUE,       # converts coefficients to odds ratios
label = list(pole ~ "Started on Pole")
) %>%
as_gt() %>%
tab_header(
title = "Effect of Pole Position on Race Win (Leclerc Ferrari 2019–2024)"
)
# Pole effect
data <- data %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
logit_model <- glm(win ~ pole, data = data, family = "binomial") %>% summary()
tbl_logit <- tbl_regression(
logit_model,
exponentiate = TRUE,       # converts coefficients to odds ratios
label = list(pole ~ "Started on Pole")
) %>%
as_gt() %>%
tab_header(
title = "Effect of Pole Position on Race Win (Leclerc Ferrari 2019–2024)"
)
rlang::last_trace()
rlang::last_trace(drop = FALSE)
sum(is.na(data$pole))
# Pole effect
data1 <- data1 %>%
mutate(pole = ifelse(grid == 1, 1, 0),
win = ifelse(positionOrder == 1, 1, 0),
podium = ifelse(positionOrder %in% c(1,2,3), 1, 0))
logit_model <- glm(win ~ pole, data = data, family = "binomial") %>% summary()
tbl_logit <- tbl_regression(
logit_model,
exponentiate = TRUE,       # converts coefficients to odds ratios
label = list(pole ~ "Started on Pole")
) %>%
as_gt() %>%
tab_header(
title = "Effect of Pole Position on Race Win (Leclerc Ferrari 2019–2024)"
)
sum(is.na(data1$pole))
str(data$win)
unique(data1$win)
str(data1$win)
logit_model <- glm(win ~ pole, data = data1, family = binomial)
tbl_logit <- tbl_regression(logit_model, exponentiate = TRUE, label = list(pole ~ "Started on Pole")) %>%
as_gt() %>%
tab_header(title = "Effect of Pole Position on Race Win (Leclerc Ferrari 2019–2024)")
tbl_logit
